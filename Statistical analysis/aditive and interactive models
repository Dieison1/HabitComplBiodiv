# In this document, we will analyze the interactive effect between habitat complexity and Urban and Cropland intensification on biodiversity 

## Load packages
library(tidyverse)
library("factoextra")
library(nlme)
library(car)
library(MASS)
library(sjPlot)

# Dataset 
# Load dataset
### Fish
DataEuaFish<-read.csv(".FishDataShare.csv", header = TRUE, sep = ";")
DataEuaFish

### Insects
DataEuaInsect<-read.csv(".InsectDataSet.csv" header = TRUE, sep = ";")
DataEuaInsect


#############################################################################################################
## Remove NAs in the specified columns
#----------------------------------------------Fish dataset--------------------------------------------------##
## First, we will create an Urban-intensity index, using the PCA method:
#  For this, we will use four human activity variables: 
# (i)  Human population
# (ii) Anthropogenic Imperviousness Surface
# (iii) Roads density
# (iv)  High-human land-use intensity

## Standardizing predictors using Log transforming:
DataEuaFish$RoadsDensity<-log(DataEuaFish$RoadsDensity+1)
DataEuaFish$DensidadePopulational<-log(DataEuaFish$DensidadePopulational+1)
DataEuaFish$HighIntensiveLandUse<-log(DataEuaFish$HighIntensiveLandUse+1)
DataEuaFish$AnthropogenicImperviousnessSufaces<-log(DataEuaFish$AnthropogenicImperviousnessSufaces+1)
## Merging Urban-activities variables
UrbanActivitiesVariables_Fish<-DataEuaFish   %>%
  dplyr::select(HighIntensiveLandUse, 
                AnthropogenicImperviousnessSufaces,
                RoadsDensity,
                DensidadePopulational)
UrbanActivitiesVariables_Fish
PCASUrbanActivitiesVariables_Fish<-prcomp(UrbanActivitiesVariables_Fish[c(1:4)],center = T, scale. = T, rank. = 3)
summary(PCASUrbanActivitiesVariables_Fish) # The PCA1 axis accounted for 84% of the variation in the urban stream variables
## Looking at the correlation between the variables and the first axis of the PCA
# PC1 vs HighIntensiveLandUse = 0.4851342
# PC1 vs AnthropogenicImperviousnessSufaces = 0.5290173
# PC1 vs RoadsDensity  = 0.4892229
# PC1 vs DensidadePopulational  = 0.4954256
# Plotting variable in the PCA axis
PlotUrbanActivitiesVariables_Fish<-fviz_pca_biplot(PCASUrbanActivitiesVariables_Fish,
                                                   repel = TRUE,geom = "none", 
                                                   col.var = "#2E9FDF", # Variables color
                                                   col.ind = "#696969",
                                                   pointsize = 0,
                                                   alpha.ind=0.4
)+ scale_x_continuous(breaks = c(-4,-2,-0, 2,4,8), limits = c(-3,8))+
  scale_y_continuous(breaks = c(-4,-2,-0, 2,4), limits = c(-3,4)) 

#####PC1 is positively correlated with all urbanization variables, so we will use the PC1 axis as a proxy for urban intensification in subsequent analyses

## Extracting PCI axis for further analysis
Axis_UrbanActivitiesVariables_Fish<-predict(PCASUrbanActivitiesVariables_Fish,UrbanActivitiesVariables_Fish)
UrbanActivityIndex_Fish<-as.data.frame(Axis_UrbanActivitiesVariables_Fish)
DataEuaFish$UrbanActivityIndex<-UrbanActivityIndex_Fish$PC1

## remove NAs in the specified columns
DataEuaFish1 <- na.omit(DataEuaFish[,c('SITE_ID', 'Ecoregions', 'YEAR', 'SDDEPTH_CM',
                                      'SumNat_PFC', 'XFC_NAT_ALG_AQM',
                                       'FishTotalDensity', 'Fish_RarefiedChaoRichness', 'ObservedFishRichness',
                                       'RegionalFishTotalLBCD', 'RegionalFishReplLBCD', 'RegionalFishRichLBCD',
                                       'InvasiveFishDensity', 'RatioInvasiveDensity', 'RiparianPresent', 'CatchmentsArea',
                                       'MeanAnnualTemperature', 'MeanPrecipitation',
                                       'UrbanActivityIndex', 'CroplandIntensity')])
#Log-transforming drivers
DataEuaFish1$CatchmentsArea<-log10(DataEuaFish1$CatchmentsArea+1)
DataEuaFish1$SDDEPTH_CM<-log10(DataEuaFish1$SDDEPTH_CM+0.1)
DataEuaFish1$SumNat_PFC<-log10(DataEuaFish1$SumNat_PFC+1)
DataEuaFish1$XFC_NAT_ALG_AQM<-log10(DataEuaFish1$XFC_NAT_ALG_AQM+1)


#----------------------------------------------Insect dataset--------------------------------------------------##
## First, we will create an Urban-intensity index, using the PCA method:
#  For this, we will use four human activity variables: 
# (i)  Human population
# (ii) Anthropogenic Imperviousness Surface
# (iii) Roads density
# (iv)  High-human land-use intensity

## Standardizing predictors using Log transforming:
DataEuaInsect$RoadsDensity<-log(DataEuaInsect$RoadsDensity+1)
DataEuaInsect$DensidadePopulational<-log(DataEuaInsect$DensidadePopulational+1)
DataEuaInsect$HighIntensiveLandUse<-log(DataEuaInsect$HighIntensiveLandUse+1)
DataEuaInsect$AnthropogenicImperviousnessSufaces<-log(DataEuaInsect$AnthropogenicImperviousnessSufaces+1)
## Merging Urban-activities variables
UrbanActivitiesVariables_Insect<-DataEuaInsect   %>%
  dplyr::select(HighIntensiveLandUse, 
                AnthropogenicImperviousnessSufaces,
                RoadsDensity,
                DensidadePopulational)
UrbanActivitiesVariables_Insect
PCASUrbanActivitiesVariables_Insect<-prcomp(UrbanActivitiesVariables_Insect[c(1:4)],center = T, scale. = T, rank. = 3)
summary(PCASUrbanActivitiesVariables_Insect) # The PCA1 axis accounted for 84% of the variation in the urban stream variables
PCASUrbanActivitiesVariables_Insect

## Looking at the correlation between the variables and the first axis of the PCA
# PC1 vs HighIntensiveLandUse = 0.4832675
# PC1 vs AnthropogenicImperviousnessSufaces = 0.5307848
# PC1 vs RoadsDensity  = 0.4877387
# PC1 vs DensidadePopulational  = 0.4968208
# Plotting variable in the PCA axis
PlotUrbanActivitiesVariables_Insect<-fviz_pca_biplot(PCASUrbanActivitiesVariables_Insect,
                                                   repel = TRUE,geom = "none", 
                                                   col.var = "#2E9FDF", # Variables color
                                                   col.ind = "#696969",
                                                   pointsize = 0,
                                                   alpha.ind=0.4
)+ scale_x_continuous(breaks = c(-4,-2,-0, 2,4,8), limits = c(-3,8))+
  scale_y_continuous(breaks = c(-4,-2,-0, 2,4), limits = c(-3,4)) 

#####PC1 is positively correlated with all urbanization variables, so we will use the PC1 axis as a proxy for urban intensification in subsequent analyses

## Extracting PCI axis for further analysis
Axis_UrbanActivitiesVariables_Insect<-predict(PCASUrbanActivitiesVariables_Insect,UrbanActivitiesVariables_Insect)
UrbanActivityIndex_Insect<-as.data.frame(Axis_UrbanActivitiesVariables_Insect)
DataEuaInsect$UrbanActivityIndex<-UrbanActivityIndex_Insect$PC1

## remove NAs in the specified columns
DataEuaInsect1 <- na.omit(DataEuaInsect[,c('SITE_ID', 'Ecoregions', 'YEAR', 'SDDEPTH_CM',
                                           'XFC_NAT_ALG_AQM', 'SumNat_PFC',
                                           'InsectDensity',  'Insect_RarefiedChaoRichness', 'ObservedInsectRichness',
                                           'RegionalInsectTotalLBCD', 'RegionalInsectReplLBCD', 'RegionalInsectRichLBCD',
                                            'RiparianPresent', 'CatchmentsArea', 'MeanAnnualTemperature', 'MeanPrecipitation',
                                           'UrbanActivityIndex', 'CroplandIntensity')])
#Log-transforming drivers
DataEuaInsect1$CatchmentsArea<-log10(DataEuaInsect1$CatchmentsArea+1)
DataEuaInsect1$SDDEPTH_CM<-log10(DataEuaInsect1$SDDEPTH_CM+0.1)
DataEuaInsect1$XFC_NAT_ALG_AQM<-log10(DataEuaInsect1$XFC_NAT_ALG_AQM+1)
DataEuaInsect1$SumNat_PFC<-log10(DataEuaInsect1$SumNat_PFC+1)


##################################################################################################################
#We will apply mixed effect models for richness, density, and LCBD of fish and insects
# drivers: habitat heterogeneity and cover + urban + cropland intensification + temperature + precipitation + RiparianPresent + stream depth and CatchmentsArea 
###Additive models
#------------------------Fish richness------------------------------#
Model1<-lme(sqrt(ObservedFishRichness) ~
            SumNat_PFC + 
            XFC_NAT_ALG_AQM + 
            I(UrbanActivityIndex^2) + 
            I(CroplandIntensity^2) + 
            MeanAnnualTemperature + 
            MeanPrecipitation + 
            SDDEPTH_CM +
            RiparianPresent + 
            CatchmentsArea,
            random =~1|YEAR/Ecoregions,
            control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
            correlation = corCompSymm(form = ~as.numeric(YEAR)),
            na.action = "na.fail",
            data = DataEuaFish1)

# Saving model output
summary(Model1)
Anova(Model1)
tab_model(Model1,transform = NULL)

# Check model assumptions
plot(Model1)
qqnorm(resid(Model1))
qqline(resid(Model1))
plot(Model1, SumNat_PFC~resid(.))
plot(Model1, XFC_NAT_ALG_AQM~resid(.))
plot(Model1, XFC_NAT_ALG_AQM~resid(.))
plot(Model1, UrbanActivityIndex~resid(.))
plot(Model1, CroplandIntensity~resid(.))
plot(Model1, MeanAnnualTemperature~resid(.))
plot(Model1, MeanPrecipitation~resid(.))#
plot(Model1, SDDEPTH_CM~resid(.))
plot(Model1, RiparianPresent~resid(.))
plot(Model1, CatchmentsArea~resid(.))
# Testing VIF
vif(Model1) ## VIF < 3, indicating no collinearity


#save estimates and CIs:
Model1_95ci<-intervals(Model1, which="fixed", level = 0.95) # get 95% CI
Model1_75ci<-intervals(Model1,which="fixed",level=0.75) #get 75% CI
Model1_df<-data.frame(cbind(Model1_95ci$fixed, Model1_75ci$fixed))
colnames(Model1_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model1_df
#write.csv(Model1_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model1_df.csv")

###Run model to get scaled estimates for plot (Figure 1)
##(This way can compare magnitude of effects across explanatory variables with different ranges)

## run model scaled
Model1_scale<-lme(sqrt(ObservedFishRichness) ~
               scale(SumNat_PFC, scale = TRUE, center = FALSE) + 
               scale(XFC_NAT_ALG_AQM, scale = TRUE, center = FALSE) + 
               scale(I(UrbanActivityIndex^2), scale = TRUE, center = FALSE) + 
               scale(I(CroplandIntensity^2), scale = TRUE, center = FALSE) + 
               scale(MeanAnnualTemperature, scale = TRUE, center = FALSE) + 
               scale(MeanPrecipitation, scale = TRUE, center = FALSE) + 
               scale(SDDEPTH_CM, scale = TRUE, center = FALSE) +
               scale(RiparianPresent, scale = TRUE, center = FALSE) + 
               scale(CatchmentsArea, scale = TRUE, center = TRUE),
               random =~1|YEAR/Ecoregions,
               control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
               correlation = corCompSymm(form = ~as.numeric(YEAR)),
               na.action = "na.fail",
               data = DataEuaFish1)

plot_summs(Model1_scale)
tab_model(Model1_scale)
summary(Model1_scale)
# Testing VIF
vif(Model1_scale) ## VIF < 3, indicating no collinearity

#save estimates and CIs:
Model1_scale_95ci<-intervals(Model1_scale, which="fixed", level = 0.95) # get 95% CI
Model1_scale_75ci<-intervals(Model1_scale,which="fixed",level=0.75) #get 75% CI
Model1_scale_df<-data.frame(cbind(Model1_scale_95ci$fixed, Model1_scale_75ci$fixed))
colnames(Model1_scale_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model1_scale_df
write.csv(Model1_scale_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model1_scale_df.csv")

#------------------------Insect richness------------------------------#
Model2<-lme(sqrt(ObservedInsectRichness) ~
             SumNat_PFC + 
             XFC_NAT_ALG_AQM + 
             UrbanActivityIndex + 
             CroplandIntensity + 
             MeanAnnualTemperature + 
             MeanPrecipitation + 
             SDDEPTH_CM +
             RiparianPresent + 
             CatchmentsArea,
             random =~1 + YEAR|Ecoregions,
             control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
             correlation = corCompSymm(form = ~as.numeric(YEAR) | YEAR|Ecoregions),
             na.action = "na.fail",
             data = DataEuaInsect1)

# Saving model output
summary(Model2)
Anova(Model2, type="II")
tab_model(Model2,transform = NULL)

# Check model assumptions
plot(Model2) 
qqnorm(resid(Model2))
qqline(resid(Model2))
plot(Model2, SumNat_PFC~resid(.))
plot(Model2, XFC_NAT_ALG_AQM~resid(.))
plot(Model2, UrbanActivityIndex~resid(.))
plot(Model2, CroplandIntensity~resid(.))
plot(Model2, MeanAnnualTemperature~resid(.))
plot(Model2, MeanPrecipitation~resid(.))
plot(Model2, SDDEPTH_CM~resid(.))
plot(Model2, RiparianPresent~resid(.))
plot(Model2, CatchmentsArea~resid(.))
# Testing VIF
vif(Model2) ## VIF < 3, indicating no collinearity


#save estimates and CIs:
Model2_95ci<-intervals(Model2, which="fixed", level = 0.95) # get 95% CI
Model2_75ci<-intervals(Model2,which="fixed",level=0.75) #get 75% CI
Model2_df<-data.frame(cbind(Model2_95ci$fixed, Model2_75ci$fixed))
colnames(Model2_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model2_df
#write.csv(Model2_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model2_df.csv")


###Run model to get scaled estimates for plot (Figure 1)
##(This way can compare magnitude of effects across explanatory variables with different ranges)
## run model scaled
Model2_scale<-lme(sqrt(ObservedInsectRichness) ~
                  scale(SumNat_PFC, scale = TRUE, center = FALSE) + 
                  scale(XFC_NAT_ALG_AQM, scale = TRUE, center = FALSE) + 
                  scale(UrbanActivityIndex, scale = TRUE, center = FALSE) + 
                  scale(CroplandIntensity, scale = TRUE, center = FALSE) + 
                  scale(MeanAnnualTemperature, scale = TRUE, center = FALSE) + 
                  scale(MeanPrecipitation, scale = TRUE, center = FALSE) + 
                  scale(SDDEPTH_CM, scale = TRUE, center = FALSE) +
                  scale(RiparianPresent, scale = TRUE, center = FALSE) + 
                  scale(CatchmentsArea, scale = TRUE, center = TRUE),
                  random =~1|YEAR/Ecoregions,
                  control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
                  correlation = corCompSymm(form = ~as.numeric(YEAR)),
                  na.action = "na.fail",
                  data = DataEuaInsect1)

plot_summs(Model2_scale)
tab_model(Model2_scale)
summary(Model10_scale)
#save estimates and CIs:
Model2_scale_95ci<-intervals(Model2_scale, which="fixed", level = 0.95) # get 95% CI
Model2_scale_75ci<-intervals(Model2_scale,which="fixed",level=0.75) #get 75% CI
Model2_scale_df<-data.frame(cbind(Model2_scale_95ci$fixed, Model2_scale_75ci$fixed))
colnames(Model2_scale_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model2_scale_df
write.csv(Model2_scale_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model2_scale_df.csv")


#------------------------Fish total density------------------------------#
Model3<-lme(log(FishTotalDensity) ~
            SumNat_PFC + 
            XFC_NAT_ALG_AQM +
            I(UrbanActivityIndex^2) + 
            I(CroplandIntensity^2) + 
            MeanAnnualTemperature + 
            MeanPrecipitation + 
            SDDEPTH_CM +
            RiparianPresent + 
            CatchmentsArea,
            random =~1|YEAR/Ecoregions,
            control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
            correlation = corCompSymm(form = ~as.numeric(YEAR)),
            na.action = "na.fail",
            data = DataEuaFish1)

# Saving model output
summary(Model3)
Anova(Model3, type="II")
tab_model(Model3,transform = NULL)

# Check model assumptions
plot(Model3) 
qqnorm(resid(Model3))
qqline(resid(Model3)) 
plot(Model3, SumNat_PFC~resid(.))
plot(Model3, XFC_NAT_ALG_AQM~resid(.))
plot(Model3, UrbanActivityIndex~resid(.))
plot(Model3, CroplandIntensity~resid(.))
plot(Model3, MeanAnnualTemperature~resid(.))
plot(Model3, MeanPrecipitation~resid(.))
plot(Model3, SDDEPTH_CM~resid(.))
plot(Model3, RiparianPresent~resid(.))
plot(Model3, CatchmentsArea~resid(.))
# Testing VIF
vif(Model3) ## VIF < 3, indicating no collinearity


#save estimates and CIs:
Model3_95ci<-intervals(Model3, which="fixed", level = 0.95) # get 95% CI
Model3_75ci<-intervals(Model3,which="fixed",level=0.75) #get 75% CI
Model3_df<-data.frame(cbind(Model3_95ci$fixed, Model3_75ci$fixed))
colnames(Model3_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model3_df
#write.csv(Model3_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model3_df.csv")


###Run model to get scaled estimates for plot (Figure 1)
##(This way can compare magnitude of effects across explanatory variables with different ranges)
## run model scaled
Model3_scale<-lme(log(FishTotalDensity) ~
                  scale(SumNat_PFC, scale = TRUE, center = FALSE) + 
                  scale(XFC_NAT_ALG_AQM, scale = TRUE, center = FALSE) + 
                  scale(I(UrbanActivityIndex^2), scale = TRUE, center = FALSE) + 
                  scale(I(CroplandIntensity^2), scale = TRUE, center = FALSE) + 
                  scale(MeanAnnualTemperature, scale = TRUE, center = FALSE) + 
                  scale(MeanPrecipitation, scale = TRUE, center = FALSE) + 
                  scale(SDDEPTH_CM, scale = TRUE, center = FALSE) +
                  scale(RiparianPresent, scale = TRUE, center = FALSE) + 
                  scale(CatchmentsArea, scale = TRUE, center = TRUE),
                  random =~1|YEAR/Ecoregions,
                  control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
                  correlation = corCompSymm(form = ~as.numeric(YEAR)),
                  na.action = "na.fail",
                  data = DataEuaFish1)

plot_summs(Model3_scale)
tab_model(Model3_scale)
summary(Model3_scale)
#save estimates and CIs:
Model3_scale_95ci<-intervals(Model3_scale, which="fixed", level = 0.95) # get 95% CI
Model3_scale_75ci<-intervals(Model3_scale,which="fixed",level=0.75) #get 75% CI
Model3_scale_df<-data.frame(cbind(Model3_scale_95ci$fixed, Model3_scale_75ci$fixed))
colnames(Model3_scale_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model3_scale_df
write.csv(Model3_scale_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model3_scale_df.csv")


#------------------------Insect total density------------------------------#
Model4<-lme(log(InsectDensity) ~
            SumNat_PFC + 
            XFC_NAT_ALG_AQM + 
            UrbanActivityIndex + 
            CroplandIntensity + 
            MeanAnnualTemperature + 
            MeanPrecipitation + 
            SDDEPTH_CM +
            RiparianPresent + 
            CatchmentsArea,
            random =~1 + YEAR|Ecoregions,
            control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
            correlation = corCompSymm(form = ~as.numeric(YEAR) | YEAR|Ecoregions),
            na.action = "na.fail",
            data = DataEuaInsect1)

# Saving model output
summary(Model4)
Anova(Model4, type="II")
tab_model(Model4,transform = NULL)

# Check model assumptions
plot(Model4) 
qqnorm(resid(Model4))
qqline(resid(Model4)) 
plot(Model4, SumNat_PFC~resid(.))
plot(Model4, XFC_NAT_ALG_AQM~resid(.))
plot(Model4, UrbanActivityIndex~resid(.))
plot(Model4, CroplandIntensity~resid(.))
plot(Model4, MeanAnnualTemperature~resid(.))
plot(Model4, MeanPrecipitation~resid(.))
plot(Model4, SDDEPTH_CM~resid(.))
plot(Model4, RiparianPresent~resid(.))
plot(Model4, CatchmentsArea~resid(.))
# Testing VIF
vif(Model4) ## VIF < 3, indicating no collinearity

#save estimates and CIs:
Model4_95ci<-intervals(Model4, which="fixed", level = 0.95) # get 95% CI
Model4_75ci<-intervals(Model4,which="fixed",level=0.75) #get 75% CI
Model4_df<-data.frame(cbind(Model4_95ci$fixed, Model4_75ci$fixed))
colnames(Model4_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model4_df
#write.csv(Model4_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model4_df.csv")


###Run model to get scaled estimates for plot (Figure 1)
##(This way can compare magnitude of effects across explanatory variables with different ranges)
## run model scaled
Model4_scale<-lme(log(InsectDensity) ~
                  scale(SumNat_PFC, scale = TRUE, center = FALSE) + 
                  scale(XFC_NAT_ALG_AQM, scale = TRUE, center = FALSE) + 
                  scale(UrbanActivityIndex, scale = TRUE, center = FALSE) + 
                  scale(CroplandIntensity, scale = TRUE, center = FALSE) + 
                  scale(MeanAnnualTemperature, scale = TRUE, center = FALSE) + 
                  scale(MeanPrecipitation, scale = TRUE, center = FALSE) + 
                  scale(SDDEPTH_CM, scale = TRUE, center = FALSE) +
                  scale(RiparianPresent, scale = TRUE, center = FALSE) + 
                  scale(CatchmentsArea, scale = TRUE, center = TRUE),
                  random =~1|YEAR/Ecoregions,
                  control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
                  correlation = corCompSymm(form = ~as.numeric(YEAR)),
                  na.action = "na.fail",
                  data = DataEuaInsect1)

plot_summs(Model4_scale)
tab_model(Model4_scale)
#save estimates and CIs:
Model4_scale_95ci<-intervals(Model4_scale, which="fixed", level = 0.95) # get 95% CI
Model4_scale_75ci<-intervals(Model4_scale,which="fixed",level=0.75) #get 75% CI
Model4_scale_df<-data.frame(cbind(Model4_scale_95ci$fixed, Model4_scale_75ci$fixed))
colnames(Model4_scale_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model4_scale_df
write.csv(Model4_scale_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model4_scale_df.csv")


#------------------------Fish regional LCBD------------------------------#
Model5<-lme(log(RegionalFishTotalLBCD) ~
            SumNat_PFC + 
            XFC_NAT_ALG_AQM + 
            UrbanActivityIndex + 
            CroplandIntensity + 
            MeanAnnualTemperature + 
            MeanPrecipitation + 
            SDDEPTH_CM +
            RiparianPresent + 
            CatchmentsArea,
            random =~1|YEAR/Ecoregions,
            control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
            correlation = corCompSymm(form = ~as.numeric(YEAR)),
            na.action = "na.fail",
            data = DataEuaFish1)


# Saving model output
summary(Model5)
Anova(Model5, type="II")
tab_model(Model5,transform = NULL)

# Check model assumptions
plot(Model5) 
qqnorm(resid(Model5))
qqline(resid(Model5))
plot(Model5, SumNat_PFC~resid(.))
plot(Model5, XFC_NAT_ALG_AQM~resid(.))
plot(Model5, UrbanActivityIndex~resid(.))
plot(Model5, CroplandIntensity~resid(.))
plot(Model5, MeanAnnualTemperature~resid(.))
plot(Model5, MeanPrecipitation~resid(.))
plot(Model5, SDDEPTH_CM~resid(.))
plot(Model5, RiparianPresent~resid(.))
plot(Model5, CatchmentsArea~resid(.))
# Testing VIF
vif(Model5) ## VIF < 3, indicating no collinearity


#save estimates and CIs:
Model5_95ci<-intervals(Model5, which="fixed", level = 0.95) # get 95% CI
Model5_75ci<-intervals(Model5,which="fixed",level=0.75) #get 75% CI
Model5_df<-data.frame(cbind(Model5_95ci$fixed, Model5_75ci$fixed))
colnames(Model5_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model5_df
#write.csv(Model5_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model5_df.csv")

###Run model to get scaled estimates for plot (Figure 1)
##(This way can compare magnitude of effects across explanatory variables with different ranges)
## run model scaled
Model5_scale<-lme(log2(RegionalFishTotalLBCD) ~
                  scale(SumNat_PFC, scale = TRUE, center = FALSE) + 
                  scale(XFC_NAT_ALG_AQM, scale = TRUE, center = FALSE) + 
                  scale(UrbanActivityIndex, scale = TRUE, center = FALSE) + 
                  scale(CroplandIntensity, scale = TRUE, center = FALSE) + 
                  scale(MeanAnnualTemperature, scale = TRUE, center = FALSE) + 
                  scale(MeanPrecipitation, scale = TRUE, center = FALSE) + 
                  scale(SDDEPTH_CM, scale = TRUE, center = FALSE) +
                  scale(RiparianPresent, scale = TRUE, center = FALSE) + 
                  scale(CatchmentsArea, scale = TRUE, center = TRUE),
                  random =~1|YEAR/Ecoregions,
                  control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
                  correlation = corCompSymm(form = ~as.numeric(YEAR)),
                  na.action = "na.fail",
                  data = DataEuaFish1)

plot_summs(Model5_scale)
tab_model(Model5_scale)
summary(Model5_scale)
#save estimates and CIs:
Model5_scale_95ci<-intervals(Model5_scale, which="fixed", level = 0.95) # get 95% CI
Model5_scale_75ci<-intervals(Model5_scale,which="fixed",level=0.75) #get 75% CI
Model5_scale_df<-data.frame(cbind(Model5_scale_95ci$fixed, Model5_scale_75ci$fixed))
colnames(Model5_scale_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model5_scale_df
write.csv(Model5_scale_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model5_scale_df.csv")


#------------------------Insect regional LCBD------------------------------#
Model6<-lme(log2(RegionalInsectTotalLBCD) ~
            SumNat_PFC + 
            XFC_NAT_ALG_AQM + 
            UrbanActivityIndex + 
            CroplandIntensity + 
            MeanAnnualTemperature + 
            MeanPrecipitation + 
            SDDEPTH_CM +
            RiparianPresent + 
            CatchmentsArea,
            random =~1 + YEAR|Ecoregions,
            control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
            correlation = corCompSymm(form = ~as.numeric(YEAR) | YEAR|Ecoregions),
            na.action = "na.fail",
            data = DataEuaInsect1)

# Saving model output
summary(Model6)
Anova(Model6, type="II")
tab_model(Model6,transform = NULL)

# Check model assumptions
plot(Model6)
qqnorm(resid(Model6))
qqline(resid(Model6)) 
plot(Model6, SumNat_PFC~resid(.))
plot(Model6, XFC_NAT_ALG_AQM~resid(.))
plot(Model6, UrbanActivityIndex~resid(.))
plot(Model6, CroplandIntensity~resid(.))
plot(Model6, MeanAnnualTemperature~resid(.))
plot(Model6, MeanPrecipitation~resid(.))
plot(Model6, SDDEPTH_CM~resid(.))
plot(Model6, RiparianPresent~resid(.))
plot(Model6, CatchmentsArea~resid(.))

# Testing VIF
vif(Model6) ## VIF < 3, indicating no collinearity


#save estimates and CIs:
Model6_95ci<-intervals(Model6, which="fixed", level = 0.95) # get 95% CI
Model6_75ci<-intervals(Model6,which="fixed",level=0.75) #get 75% CI
Model6_df<-data.frame(cbind(Model6_95ci$fixed, Model6_75ci$fixed))
colnames(Model6_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model6_df
#write.csv(Model5_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model5_df.csv")

###Run model to get scaled estimates for plot (Figure 1)
##(This way can compare magnitude of effects across explanatory variables with different ranges)

## run model scaled
Model6_scale<-lme(log2(RegionalInsectTotalLBCD) ~
                  scale(SumNat_PFC, scale = TRUE, center = FALSE) + 
                  scale(XFC_NAT_ALG_AQM, scale = TRUE, center = FALSE) + 
                  scale(UrbanActivityIndex, scale = TRUE, center = FALSE) + 
                  scale(CroplandIntensity, scale = TRUE, center = FALSE) + 
                  scale(MeanAnnualTemperature, scale = TRUE, center = FALSE) + 
                  scale(MeanPrecipitation, scale = TRUE, center = FALSE) + 
                  scale(SDDEPTH_CM, scale = TRUE, center = FALSE) +
                  scale(RiparianPresent, scale = TRUE, center = FALSE) + 
                  scale(CatchmentsArea, scale = TRUE, center = TRUE),
                  random =~1|YEAR/Ecoregions,
                  control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
                  correlation = corCompSymm(form = ~as.numeric(YEAR)),
                  na.action = "na.fail",
                  data = DataEuaInsect1)
plot_summs(Model6_scale)
tab_model(Model6_scale)
#save estimates and CIs:
Model6_scale_95ci<-intervals(Model6_scale, which="fixed", level = 0.95) # get 95% CI
Model6_scale_75ci<-intervals(Model6_scale,which="fixed",level=0.75) #get 75% CI
Model6_scale_df<-data.frame(cbind(Model6_scale_95ci$fixed, Model6_scale_75ci$fixed))
colnames(Model6_scale_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model6_scale_df
write.csv(Model6_scale_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model6_scale_df.csv")


#------------------------Fish LCBD richness difference------------------------------#
Model7<-lme(log2(RegionalFishRichLBCD) ~
            SumNat_PFC + 
            XFC_NAT_ALG_AQM + 
            UrbanActivityIndex + 
            CroplandIntensity + 
            MeanAnnualTemperature + 
            MeanPrecipitation + 
            SDDEPTH_CM +
            RiparianPresent + 
            CatchmentsArea,
            random =~1|YEAR/Ecoregions,
            control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
            correlation = corCompSymm(form = ~as.numeric(YEAR)),
            na.action = "na.fail",
            data = DataEuaFish1)


# Saving model output
summary(Model7)
Anova(Model7, type="II")
tab_model(Model7,transform = NULL)

# Check model assumptions
plot(Model7) 
qqnorm(resid(Model7))
qqline(resid(Model7))
plot(Model7, SumNat_PFC~resid(.))
plot(Model7, XFC_NAT_ALG_AQM~resid(.))
plot(Model7, UrbanActivityIndex~resid(.))
plot(Model7, CroplandIntensity~resid(.))
plot(Model7, MeanAnnualTemperature~resid(.))
plot(Model7, MeanPrecipitation~resid(.))
plot(Model7, SDDEPTH_CM~resid(.))
plot(Model7, RiparianPresent~resid(.))
plot(Model7, CatchmentsArea~resid(.))

# Testing VIF
vif(Model7) ## VIF < 3, indicating no collinearity

#save estimates and CIs:
Model7_95ci<-intervals(Model7, which="fixed", level = 0.95) # get 95% CI
Model7_75ci<-intervals(Model7,which="fixed",level=0.75) #get 75% CI
Model7_df<-data.frame(cbind(Model7_95ci$fixed, Model7_75ci$fixed))
colnames(Model7_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model7_df
#write.csv(Model7_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model7_df.csv")


## run model scaled
Model7_scale<-lme(log2(RegionalFishRichLBCD) ~
                  scale(SumNat_PFC, scale = TRUE, center = FALSE) + 
                  scale(XFC_NAT_ALG_AQM, scale = TRUE, center = FALSE) + 
                  scale(UrbanActivityIndex, scale = TRUE, center = FALSE) + 
                  scale(CroplandIntensity, scale = TRUE, center = FALSE) + 
                  scale(MeanAnnualTemperature, scale = TRUE, center = FALSE) + 
                  scale(MeanPrecipitation, scale = TRUE, center = FALSE) + 
                  scale(SDDEPTH_CM, scale = TRUE, center = FALSE) +
                  scale(RiparianPresent, scale = TRUE, center = FALSE) + 
                  scale(CatchmentsArea, scale = TRUE, center = TRUE),
                  random =~1|YEAR/Ecoregions,
                  control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
                  correlation = corCompSymm(form = ~as.numeric(YEAR)),
                  na.action = "na.fail",
                  data = DataEuaFish1)


plot_summs(Model7_scale)
tab_model(Model7_scale)
#save estimates and CIs:
Model7_scale_95ci<-intervals(Model7_scale, which="fixed", level = 0.95) # get 95% CI
Model7_scale_75ci<-intervals(Model7_scale,which="fixed",level=0.75) #get 75% CI
Model7_scale_df<-data.frame(cbind(Model7_scale_95ci$fixed, Model7_scale_75ci$fixed))
colnames(Model7_scale_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model7_scale_df
write.csv(Model7_scale_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model7_scale_df.csv")


#------------------------Insect LCBD richness difference------------------------------#
Model8<-lme(log2(RegionalInsectRichLBCD) ~
            SumNat_PFC + 
            XFC_NAT_ALG_AQM + 
            UrbanActivityIndex + 
            CroplandIntensity + 
            MeanAnnualTemperature + 
            MeanPrecipitation + 
            SDDEPTH_CM +
            RiparianPresent + 
            CatchmentsArea,
            random =~1 + YEAR|Ecoregions,
            control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
            correlation = corCompSymm(form = ~as.numeric(YEAR) | YEAR|Ecoregions),
            na.action = "na.fail",
            data = DataEuaInsect1)

# Saving model output
summary(Model8)
Anova(Model8, type="II")
tab_model(Model8,transform = NULL)

# Check model assumptions
plot(Model8) 
qqnorm(resid(Model8))
qqline(resid(Model8)) 
plot(Model8, SumNat_PFC~resid(.))
plot(Model8, XFC_NAT_ALG_AQM~resid(.))
plot(Model8, UrbanActivityIndex~resid(.))
plot(Model8, CroplandIntensity~resid(.))
plot(Model8, MeanAnnualTemperature~resid(.))
plot(Model8, MeanPrecipitation~resid(.))
plot(Model8, SDDEPTH_CM~resid(.))
plot(Model8, RiparianPresent~resid(.))
plot(Model8, CatchmentsArea~resid(.))

# Testing VIF
vif(Model8) ## VIF < 3, indicating no collinearity

#save estimates and CIs:
Model8_95ci<-intervals(Model8, which="fixed", level = 0.95) # get 95% CI
Model8_75ci<-intervals(Model8,which="fixed",level=0.75) #get 75% CI
Model8_df<-data.frame(cbind(Model8_95ci$fixed, Model8_75ci$fixed))
colnames(Model8_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model8_df
#write.csv(Model8_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model8_df.csv")

## run model scaled
Model8_scale<-lme(log2(RegionalInsectRichLBCD) ~
                  scale(SumNat_PFC, scale = TRUE, center = FALSE) + 
                  scale(XFC_NAT_ALG_AQM, scale = TRUE, center = FALSE) + 
                  scale(UrbanActivityIndex, scale = TRUE, center = FALSE) + 
                  scale(CroplandIntensity, scale = TRUE, center = FALSE) + 
                  scale(MeanAnnualTemperature, scale = TRUE, center = FALSE) + 
                  scale(MeanPrecipitation, scale = TRUE, center = FALSE) + 
                  scale(SDDEPTH_CM, scale = TRUE, center = FALSE) +
                  scale(RiparianPresent, scale = TRUE, center = FALSE) + 
                  scale(CatchmentsArea, scale = TRUE, center = TRUE),
                  random =~1|YEAR/Ecoregions,
                  control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
                  correlation = corCompSymm(form = ~as.numeric(YEAR)),
                  na.action = "na.fail",
                  data = DataEuaInsect1)

plot_summs(Model8_scale)
tab_model(Model8_scale)
#save estimates and CIs:
Model8_scale_95ci<-intervals(Model8_scale, which="fixed", level = 0.95) # get 95% CI
Model8_scale_75ci<-intervals(Model8_scale,which="fixed",level=0.75) #get 75% CI
Model8_scale_df<-data.frame(cbind(Model8_scale_95ci$fixed, Model8_scale_75ci$fixed))
colnames(Model8_scale_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model8_scale_df
write.csv(Model8_scale_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model8_scale_df.csv")



#------------------------Fish LCBD replacement------------------------------#
Model9<-lme(log2(RegionalFishReplLBCD) ~
            SumNat_PFC + 
            XFC_NAT_ALG_AQM + 
            UrbanActivityIndex + 
            CroplandIntensity + 
            MeanAnnualTemperature + 
            MeanPrecipitation + 
            SDDEPTH_CM +
            RiparianPresent + 
            CatchmentsArea,
            random =~1|YEAR/Ecoregions,
            control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
            correlation = corCompSymm(form = ~as.numeric(YEAR)),
            na.action = "na.fail",
            data = DataEuaFish1)


# Saving model output
summary(Model9)
Anova(Model9, type="II")
tab_model(Model9,transform = NULL)

# Check model assumptions
plot(Model9) 
qqnorm(resid(Model9))
qqline(resid(Model9))  
plot(Model9, SumNat_PFC~resid(.))
plot(Model9, XFC_NAT_ALG_AQM~resid(.))
plot(Model9, UrbanActivityIndex~resid(.))
plot(Model9, CroplandIntensity~resid(.))
plot(Model9, MeanAnnualTemperature~resid(.))
plot(Model9, MeanPrecipitation~resid(.))
plot(Model9, SDDEPTH_CM~resid(.))
plot(Model9, RiparianPresent~resid(.))
plot(Model9, CatchmentsArea~resid(.))

# Testing VIF
vif(Model9) ## VIF < 3, indicating no collinearity

#save estimates and CIs:
Model9_95ci<-intervals(Model9, which="fixed", level = 0.95) # get 95% CI
Model9_75ci<-intervals(Model9,which="fixed",level=0.75) #get 75% CI
Model9_df<-data.frame(cbind(Model9_95ci$fixed, Model9_75ci$fixed))
colnames(Model9_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model9_df
#write.csv(Model9_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model9_df.csv")


## run model scaled
Model9_scale<-lme(log(RegionalFishReplLBCD) ~
                  scale(SumNat_PFC, scale = TRUE, center = FALSE) + 
                  scale(XFC_NAT_ALG_AQM, scale = TRUE, center = FALSE) + 
                  scale(UrbanActivityIndex, scale = TRUE, center = FALSE) + 
                  scale(CroplandIntensity, scale = TRUE, center = FALSE) + 
                  scale(MeanAnnualTemperature, scale = TRUE, center = FALSE) + 
                  scale(MeanPrecipitation, scale = TRUE, center = FALSE) + 
                  scale(SDDEPTH_CM, scale = TRUE, center = FALSE) +
                  scale(RiparianPresent, scale = TRUE, center = FALSE) + 
                  scale(CatchmentsArea, scale = TRUE, center = TRUE),
                  random =~1|YEAR/Ecoregions,
                  control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
                  correlation = corCompSymm(form = ~as.numeric(YEAR)),
                  na.action = "na.fail",
                  data = DataEuaFish1)


plot_summs(Model9_scale)
tab_model(Model9_scale)
#save estimates and CIs:
Model9_scale_95ci<-intervals(Model9_scale, which="fixed", level = 0.95) # get 95% CI
Model9_scale_75ci<-intervals(Model9_scale,which="fixed",level=0.75) #get 75% CI
Model9_scale_df<-data.frame(cbind(Model9_scale_95ci$fixed, Model9_scale_75ci$fixed))
colnames(Model9_scale_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model9_scale_df
write.csv(Model9_scale_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model9_scale_df.csv")


#------------------------Insect LCBD replacement------------------------------#
Model10<-lme(log2(RegionalInsectReplLBCD) ~
             SumNat_PFC + 
             XFC_NAT_ALG_AQM + 
             UrbanActivityIndex + 
             CroplandIntensity + 
             MeanAnnualTemperature + 
             MeanPrecipitation + 
             SDDEPTH_CM +
             RiparianPresent + 
             CatchmentsArea,
             random =~1 + YEAR|Ecoregions,
             control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
             correlation = corCompSymm(form = ~as.numeric(YEAR) | YEAR|Ecoregions),
             na.action = "na.fail",
             data = DataEuaInsect1)

# Saving model output
summary(Model10)
Anova(Model10, type="II")
tab_model(Model10,transform = NULL)

# Check model assumptions
plot(Model10) 
qqnorm(resid(Model10))
qqline(resid(Model10)) 
plot(Model10, SumNat_PFC~resid(.))
plot(Model10, XFC_NAT_ALG_AQM~resid(.))
plot(Model10, UrbanActivityIndex~resid(.))
plot(Model10, CroplandIntensity~resid(.))
plot(Model10, MeanAnnualTemperature~resid(.))
plot(Model10, MeanPrecipitation~resid(.))
plot(Model10, SDDEPTH_CM~resid(.))
plot(Model10, RiparianPresent~resid(.))
plot(Model10, CatchmentsArea~resid(.))

# Testing VIF
vif(Model10) ## VIF < 3, indicating no collinearity

#save estimates and CIs:
Model10_95ci<-intervals(Model10, which="fixed", level = 0.95) # get 95% CI
Model10_75ci<-intervals(Model10,which="fixed",level=0.75) #get 75% CI
Model10_df<-data.frame(cbind(Model10_95ci$fixed, Model10_75ci$fixed))
colnames(Model10_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model10_df
#write.csv(Model9_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model9_df.csv")


## run model scaled
Model10_scale<-lme(log2(RegionalInsectReplLBCD) ~
                   scale(SumNat_PFC, scale = TRUE, center = FALSE) + 
                   scale(XFC_NAT_ALG_AQM, scale = TRUE, center = FALSE) + 
                   scale(UrbanActivityIndex, scale = TRUE, center = FALSE) + 
                   scale(CroplandIntensity, scale = TRUE, center = FALSE) + 
                   scale(MeanAnnualTemperature, scale = TRUE, center = FALSE) + 
                   scale(MeanPrecipitation, scale = TRUE, center = FALSE) + 
                   scale(SDDEPTH_CM, scale = TRUE, center = FALSE) +
                   scale(RiparianPresent, scale = TRUE, center = FALSE) + 
                   scale(CatchmentsArea, scale = TRUE, center = TRUE),
                   random =~1|YEAR/Ecoregions,
                   control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
                   correlation = corCompSymm(form = ~as.numeric(YEAR)),
                   na.action = "na.fail",
                   data = DataEuaInsect1)
plot_summs(Model10_scale)
tab_model(Model10_scale)
#save estimates and CIs:
Model10_scale_95ci<-intervals(Model10_scale, which="fixed", level = 0.95) # get 95% CI
Model10_scale_75ci<-intervals(Model10_scale,which="fixed",level=0.75) #get 75% CI
Model10_scale_df<-data.frame(cbind(Model10_scale_95ci$fixed, Model10_scale_75ci$fixed))
colnames(Model10_scale_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model10_scale_df
write.csv(Model10_scale_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model10_scale_df.csv")



######################################################################################################################################
###Now, we will analyze the role of habitat heterogeneity in buffering the impacts of human-induced disturbance on diversity 
###To do this, we will apply an interactive model of habitat heterogeneity vs. human land-uses (agriculture + urbanisation).
###Interactive models
###Scale and centralize all the predictors


DataEuaFish1 <- DataEuaFish1 %>%
  # group_by(Ecoregions) %>%
  mutate(
    SumNat_PFC_scale = scale(SumNat_PFC,scale = T, center = F),
    XFC_NAT_ALG_AQM_scale = scale(XFC_NAT_ALG_AQM, scale = T, center = F),
    UrbanActivityIndex_scale = scale(UrbanActivityIndex, scale = T, center = F),
    CroplandIntensity_scale = scale(CroplandIntensity,   scale = T, center = F),
    MeanAnnualTemperature_scale = scale(MeanAnnualTemperature,   scale = T, center = F),
    MeanPrecipitation_scale = scale(MeanPrecipitation,   scale = T, center = F),
    SDDEPTH_CM_scale = scale(SDDEPTH_CM,   scale = T, center = F),
    RiparianPresent_scale = scale(RiparianPresent,   scale = T, center = F),
    CatchmentsArea_scale = scale(CatchmentsArea,   scale = T, center = F),
    )

###Now, we will scale all variables. This makes the interaction term in model comparable
DataEuaInsect1 <- DataEuaInsect1 %>%
  # group_by(Ecoregions) %>%
  mutate(
    SumNat_PFC_scale = scale(SumNat_PFC,scale = T, center = F),
    XFC_NAT_ALG_AQM_scale = scale(XFC_NAT_ALG_AQM, scale = T, center = F),
    UrbanActivityIndex_scale = scale(UrbanActivityIndex, scale = T, center = F),
    CroplandIntensity_scale = scale(CroplandIntensity,   scale = T, center = F),
    MeanAnnualTemperature_scale = scale(MeanAnnualTemperature,   scale = T, center = F),
    MeanPrecipitation_scale = scale(MeanPrecipitation,   scale = T, center = F),
    SDDEPTH_CM_scale = scale(SDDEPTH_CM,   scale = T, center = F),
    RiparianPresent_scale = scale(RiparianPresent,   scale = T, center = F),
    CatchmentsArea_scale = scale(CatchmentsArea,   scale = T, center = F),
  )


## run model scaled
Model11_scale<-lme(sqrt(ObservedFishRichness) ~
                   SumNat_PFC_scale * I(UrbanActivityIndex_scale^2) + 
                   SumNat_PFC_scale * I(CroplandIntensity_scale^2) + 
                   XFC_NAT_ALG_AQM_scale + 
                   MeanAnnualTemperature_scale + 
                   MeanPrecipitation_scale + 
                   SDDEPTH_CM_scale +
                   RiparianPresent_scale + 
                   CatchmentsArea_scale,
                   random =~1|YEAR/Ecoregions,
                   control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
                   correlation = corCompSymm(form = ~as.numeric(YEAR)),
                   na.action = "na.fail",
                   data = DataEuaFish1)

#save estimates and CIs:
Model11_scale_95ci<-intervals(Model11_scale, which="fixed", level = 0.95) # get 95% CI
Model11_scale_75ci<-intervals(Model11_scale,which="fixed",level=0.75) #get 75% CI
Model11_scale_df<-data.frame(cbind(Model11_scale_95ci$fixed, Model11_scale_75ci$fixed))
colnames(Model11_scale_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model11_scale_df
write.csv(Model11_scale_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model11_scale_df.csv")


######get marginal effects to plot PREDICT lines
PredictData_model11<-ggpredict(Model11_scale, terms = c("SumNat_PFC_scale[all]"), 
                              ci.lvl=0.95,back.transform = F)
plot(PredictData_model11, show_data = F)
write.csv(PredictData_model11,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\PredictData_model11.csv")

######saving dataset scaled and standardized
ScaledFishRichnessData<-cbind(DataEuaFish1$ObservedFishRichness, DataEuaFish1$SumNat_PFC_scale,DataEuaFish1$Ecoregions)
write.csv(ScaledFishRichnessData,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\ScaledFishRichnessData.csv")



## -----Insect community
## run model scaled
Model12_scale<-lme(sqrt(ObservedInsectRichness) ~
                   SumNat_PFC_scale * UrbanActivityIndex_scale + 
                   SumNat_PFC_scale * CroplandIntensity_scale + 
                   XFC_NAT_ALG_AQM_scale + 
                   MeanAnnualTemperature_scale + 
                   MeanPrecipitation_scale + 
                   SDDEPTH_CM_scale +
                   RiparianPresent_scale + 
                   CatchmentsArea_scale,
                   random =~1|YEAR/Ecoregions,
                   control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
                   correlation = corCompSymm(form = ~as.numeric(YEAR)),
                   na.action = "na.fail",
                  data = DataEuaInsect1)


#save estimates and CIs:
Model12_scale_95ci<-intervals(Model12_scale, which="fixed", level = 0.95) # get 95% CI
Model12_scale_75ci<-intervals(Model12_scale,which="fixed",level=0.75) #get 75% CI
Model12_scale_df<-data.frame(cbind(Model12_scale_95ci$fixed, Model12_scale_75ci$fixed))
colnames(Model12_scale_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model12_scale_df
write.csv(Model12_scale_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model12_scale_df.csv")


######get marginal effects to plot PREDICT lines
PredictData_model12<-ggpredict(Model12_scale, terms = c("SumNat_PFC_scale[all]"), 
                              ci.lvl=0.95,back.transform = F)
plot(PredictData_model12, show_data = F)
write.csv(PredictData_model12,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\PredictData_model12.csv")

######saving dataset scaled and standardized
ScaledInsectRichnessData<-cbind(DataEuaInsect1$ObservedInsectRichness, DataEuaInsect1$SumNat_PFC_scale,DataEuaInsect1$Ecoregions)
write.csv(ScaledInsectRichnessData,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\ScaledInsectRichnessData.csv")


###------------------------------ Total density-----------------------------###
## -----Fish community
## run model scaled
Model13_scale<-lme(log(FishTotalDensity) ~
                   SumNat_PFC_scale * I(UrbanActivityIndex_scale^2) + 
                   SumNat_PFC_scale * I(CroplandIntensity_scale^2) + 
                   XFC_NAT_ALG_AQM_scale + 
                   MeanAnnualTemperature_scale + 
                   MeanPrecipitation_scale + 
                   SDDEPTH_CM_scale +
                   RiparianPresent_scale + 
                   CatchmentsArea_scale,
                   random =~1|YEAR/Ecoregions,
                   control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
                   correlation = corCompSymm(form = ~as.numeric(YEAR)),
                   na.action = "na.fail",
                   data = DataEuaFish1)



#save estimates and CIs:
Model13_scale_95ci<-intervals(Model13_scale, which="fixed", level = 0.95) # get 95% CI
Model13_scale_75ci<-intervals(Model13_scale,which="fixed",level=0.75) #get 75% CI
Model13_scale_df<-data.frame(cbind(Model13_scale_95ci$fixed, Model13_scale_75ci$fixed))
colnames(Model13_scale_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model13_scale_df
write.csv(Model13_scale_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model13_scale_df.csv")


######get marginal effects to plot PREDICT lines
PredictData_model13<-ggpredict(Model13_scale, terms = c("SumNat_PFC_scale[all]"), 
                              ci.lvl=0.95,back.transform = F)

plot(PredictData_model13, show_data = F)
write.csv(PredictData_model13,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\PredictData_model13.csv")

######saving dataset scaled and standardized
ScaledFishDensityData<-cbind(DataEuaFish1$FishTotalDensity, DataEuaFish1$SumNat_PFC_scale,DataEuaFish1$Ecoregions)
write.csv(ScaledFishDensityData,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\ScaledFishDensityData.csv")


## -----Insect community
## run model scaled
Model14_scale<-lme(log(InsectDensity) ~
                   SumNat_PFC_scale * UrbanActivityIndex_scale + 
                   SumNat_PFC_scale * CroplandIntensity_scale + 
                   XFC_NAT_ALG_AQM_scale + 
                   MeanAnnualTemperature_scale + 
                   MeanPrecipitation_scale + 
                   SDDEPTH_CM_scale +
                   RiparianPresent_scale + 
                   CatchmentsArea_scale,
                   random =~1|YEAR/Ecoregions,
                   control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
                   correlation = corCompSymm(form = ~as.numeric(YEAR)),
                   na.action = "na.fail",
                   data = DataEuaInsect1)


#save estimates and CIs:
Model14_scale_95ci<-intervals(Model14_scale, which="fixed", level = 0.95) # get 95% CI
Model14_scale_75ci<-intervals(Model14_scale,which="fixed",level=0.75) #get 75% CI
Model14_scale_df<-data.frame(cbind(Model14_scale_95ci$fixed, Model14_scale_75ci$fixed))
colnames(Model14_scale_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model14_scale_df
write.csv(Model14_scale_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model14_scale_df.csv")

######get marginal effects to plot PREDICT lines
PredictData_model14<-ggpredict(Model14_scale, terms = c("SumNat_PFC_scale[all]"), 
                              ci.lvl=0.95,back.transform = F)
plot(PredictData_model14, show_data = F)
write.csv(PredictData_model14,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\PredictData_model14.csv")

######saving dataset scaled and standardized
ScaledInsectDensityData<-cbind(DataEuaInsect1$InsectDensity, DataEuaInsect1$SumNat_PFC_scale,DataEuaInsect1$Ecoregions)
write.csv(ScaledInsectDensityData,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\ScaledInsectDensityData.csv")

###------------------------------Regional LCBD-----------------------------###
## -----Fish community
## run model scaled
Model15_scale<-lme(log2(RegionalFishTotalLBCD) ~
                   SumNat_PFC_scale * UrbanActivityIndex_scale + 
                   SumNat_PFC_scale * CroplandIntensity_scale + 
                   XFC_NAT_ALG_AQM_scale + 
                   MeanAnnualTemperature_scale + 
                   MeanPrecipitation_scale + 
                   SDDEPTH_CM_scale +
                   RiparianPresent_scale + 
                   CatchmentsArea_scale,
                   random =~1|YEAR/Ecoregions,
                   control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
                   correlation = corCompSymm(form = ~as.numeric(YEAR)),
                   na.action = "na.fail",
                   data = DataEuaFish1)

#save estimates and CIs:
Model15_scale_95ci<-intervals(Model15_scale, which="fixed", level = 0.95) # get 95% CI
Model15_scale_75ci<-intervals(Model15_scale,which="fixed",level=0.75) #get 75% CI
Model15_scale_df<-data.frame(cbind(Model15_scale_95ci$fixed, Model15_scale_75ci$fixed))
colnames(Model15_scale_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model15_scale_df
write.csv(Model15_scale_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model15_scale_df.csv")


######get marginal effects to plot PREDICT lines
PredictData_model15<-ggpredict(Model15_scale, terms = c("SumNat_PFC_scale[all]"), 
                               ci.lvl=0.95,back.transform = F)
plot(PredictData_model15, show_data = F, jitter = 0.02)
write.csv(PredictData_model15,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\PredictData_model15.csv")

######saving dataset scaled and standardized
ScaledFishLCBDData<-cbind(DataEuaFish1$RegionalFishTotalLBCD, DataEuaFish1$SumNat_PFC_scale,DataEuaFish1$Ecoregions)
write.csv(ScaledFishLCBDData,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\ScaledFishLCBDData.csv")


## -----Insect community
## run model scaled
Model16_scale<-lme(log2(RegionalInsectTotalLBCD) ~
                   SumNat_PFC_scale * UrbanActivityIndex_scale + 
                   SumNat_PFC_scale * CroplandIntensity_scale + 
                   XFC_NAT_ALG_AQM_scale + 
                   MeanAnnualTemperature_scale + 
                   MeanPrecipitation_scale + 
                   SDDEPTH_CM_scale +
                   RiparianPresent_scale + 
                   CatchmentsArea_scale,
                   random =~1|YEAR/Ecoregions,
                   control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
                   correlation = corCompSymm(form = ~as.numeric(YEAR)),
                   na.action = "na.fail",
                   data = DataEuaInsect1)

#save estimates and CIs:
Model16_scale_95ci<-intervals(Model16_scale, which="fixed", level = 0.95) # get 95% CI
Model16_scale_75ci<-intervals(Model16_scale,which="fixed",level=0.75) #get 75% CI
Model16_scale_df<-data.frame(cbind(Model16_scale_95ci$fixed, Model16_scale_75ci$fixed))
colnames(Model16_scale_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model16_scale_df
write.csv(Model16_scale_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model16_scale_df.csv")

######get marginal effects to plot PREDICT lines
PredictData_model16<-ggpredict(Model16_scale, terms = c("SumNat_PFC_scale[all]"), 
                               ci.lvl=0.95,back.transform = F)
plot(PredictData_model16, show_data = F, jitter = 0.02)
write.csv(PredictData_model16,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\PredictData_model16.csv")

######saving dataset scaled and standardized
ScaledInsectLCBDData<-cbind(DataEuaInsect1$RegionalInsectTotalLBCD, DataEuaInsect1$SumNat_PFC_scale,DataEuaInsect1$Ecoregions)
write.csv(ScaledInsectLCBDData,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\ScaledInsectLCBDData.csv")


###------------------------------LCBD richness difference-----------------------------###
## -----Fish community
## run model scaled
Model17_scale<-lme(log2(RegionalFishRichLBCD) ~
                   SumNat_PFC_scale * UrbanActivityIndex_scale + 
                   SumNat_PFC_scale * CroplandIntensity_scale + 
                   XFC_NAT_ALG_AQM_scale + 
                   MeanAnnualTemperature_scale + 
                   MeanPrecipitation_scale + 
                   SDDEPTH_CM_scale +
                   RiparianPresent_scale + 
                   CatchmentsArea_scale,
                   random =~1|YEAR/Ecoregions,
                   control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
                   correlation = corCompSymm(form = ~as.numeric(YEAR)),
                   na.action = "na.fail",
                   data = DataEuaFish1)

#save estimates and CIs:
Model17_scale_95ci<-intervals(Model17_scale, which="fixed", level = 0.95) # get 95% CI
Model17_scale_75ci<-intervals(Model17_scale,which="fixed",level=0.75) #get 75% CI
Model17_scale_df<-data.frame(cbind(Model17_scale_95ci$fixed, Model17_scale_75ci$fixed))
colnames(Model17_scale_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model17_scale_df
write.csv(Model17_scale_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model17_scale_df.csv")


######get marginal effects to plot PREDICT lines
PredictData_model17<-ggpredict(Model17_scale, terms = c("SumNat_PFC_scale[all]"), 
                               ci.lvl=0.95,back.transform = F)
plot(PredictData_model17, show_data = F, jitter = 0.02)
write.csv(PredictData_model17,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\PredictData_model17.csv")

######saving dataset scaled and standardized
ScaledFishRichnessDiffData<-cbind(DataEuaFish1$RegionalFishRichLBCD, DataEuaFish1$SumNat_PFC_scale,DataEuaFish1$Ecoregions)
write.csv(ScaledFishRichnessDiffData,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\ScaledFishRichnessDiffData.csv")



## -----Insect community
## run model scaled
Model18_scale<-lme(log2(RegionalInsectRichLBCD) ~
                   SumNat_PFC_scale * UrbanActivityIndex_scale + 
                   SumNat_PFC_scale * CroplandIntensity_scale + 
                   XFC_NAT_ALG_AQM_scale + 
                   MeanAnnualTemperature_scale + 
                   MeanPrecipitation_scale + 
                   SDDEPTH_CM_scale +
                   RiparianPresent_scale + 
                   CatchmentsArea_scale,
                   random =~1|YEAR/Ecoregions,
                   control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
                   correlation = corCompSymm(form = ~as.numeric(YEAR)),
                   na.action = "na.fail",
                   data = DataEuaInsect1)

#save estimates and CIs:
Model18_scale_95ci<-intervals(Model18_scale, which="fixed", level = 0.95) # get 95% CI
Model18_scale_75ci<-intervals(Model18_scale,which="fixed",level=0.75) #get 75% CI
Model18_scale_df<-data.frame(cbind(Model18_scale_95ci$fixed, Model18_scale_75ci$fixed))
colnames(Model18_scale_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model18_scale_df
write.csv(Model18_scale_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model18_scale_df.csv")


######get marginal effects to plot PREDICT lines
PredictData_model18<-ggpredict(Model18_scale, terms = c("SumNat_PFC_scale[all]"), 
                               ci.lvl=0.95,back.transform = F)
plot(PredictData_model18, show_data = F, jitter = 0.02)
write.csv(PredictData_model18,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\PredictData_model18.csv")

######saving dataset scaled and standardized
ScaledFishRichnessDiffData<-cbind(DataEuaInsect1$RegionalInsectRichLBCD, DataEuaInsect1$SumNat_PFC_scale,DataEuaInsect1$Ecoregions)
write.csv(ScaledFishRichnessDiffData,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\ScaledFishRichnessDiffData.csv")

###------------------------------LCBD replacement-----------------------------###
## -----Fish community
## run model scaled
Model19_scale<-lme(log2(RegionalFishReplLBCD) ~
                   SumNat_PFC_scale * UrbanActivityIndex_scale + 
                   SumNat_PFC_scale * CroplandIntensity_scale + 
                   XFC_NAT_ALG_AQM_scale + 
                   MeanAnnualTemperature_scale + 
                   MeanPrecipitation_scale + 
                   SDDEPTH_CM_scale +
                   RiparianPresent_scale + 
                   CatchmentsArea_scale,
                   random =~1|YEAR/Ecoregions,
                   control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
                   correlation = corCompSymm(form = ~as.numeric(YEAR)),
                   na.action = "na.fail",
                   data = DataEuaFish1)

#save estimates and CIs:
Model19_scale_95ci<-intervals(Model19_scale, which="fixed", level = 0.95) # get 95% CI
Model19_scale_75ci<-intervals(Model19_scale,which="fixed",level=0.75) #get 75% CI
Model19_scale_df<-data.frame(cbind(Model19_scale_95ci$fixed, Model19_scale_75ci$fixed))
colnames(Model19_scale_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model19_scale_df
write.csv(Model19_scale_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model19_scale_df.csv")


######get marginal effects to plot PREDICT lines
PredictData_model19<-ggpredict(Model19_scale, terms = c("SumNat_PFC_scale[all]"), 
                               ci.lvl=0.95,back.transform = F)
plot(PredictData_model19, show_data = F, jitter = 0.02)
write.csv(PredictData_model19,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\PredictData_model19.csv")

######saving dataset scaled and standardized
ScaledFishReplacementData<-cbind(DataEuaFish1$RegionalFishReplLBCD, DataEuaFish1$SumNat_PFC_scale,DataEuaFish1$Ecoregions)
write.csv(ScaledFishReplacementData,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\ScaledFishReplacementData.csv")


## -----Insect community
## run model scaled
Model20_scale<-lme(log2(RegionalInsectReplLBCD) ~
                   SumNat_PFC_scale * UrbanActivityIndex_scale + 
                   SumNat_PFC_scale * CroplandIntensity_scale + 
                   XFC_NAT_ALG_AQM_scale + 
                   MeanAnnualTemperature_scale + 
                   MeanPrecipitation_scale + 
                   SDDEPTH_CM_scale +
                   RiparianPresent_scale + 
                   CatchmentsArea_scale,
                   random =~1|YEAR/Ecoregions,
                   control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
                   correlation = corCompSymm(form = ~as.numeric(YEAR)),
                   na.action = "na.fail",
                   data = DataEuaInsect1)

#save estimates and CIs:
Model20_scale_95ci<-intervals(Model20_scale, which="fixed", level = 0.95) # get 95% CI
Model20_scale_75ci<-intervals(Model20_scale,which="fixed",level=0.75) #get 75% CI
Model20_scale_df<-data.frame(cbind(Model20_scale_95ci$fixed, Model20_scale_75ci$fixed))
colnames(Model20_scale_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model20_scale_df
write.csv(Model20_scale_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model20_scale_df.csv")


######get marginal effects to plot PREDICT lines
PredictData_model20<-ggpredict(Model20_scale, terms = c("SumNat_PFC_scale[all]"), 
                               ci.lvl=0.95,back.transform = F)
plot(PredictData_model20, show_data = F, jitter = 0.02)
write.csv(PredictData_model20,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\PredictData_model20.csv")

######saving dataset scaled and standardized
ScaledInsectReplacementData<-cbind(DataEuaInsect1$RegionalInsectReplLBCD, DataEuaInsect1$SumNat_PFC_scale,DataEuaInsect1$Ecoregions)
write.csv(ScaledInsectReplacementData,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\ScaledInsectReplacementData.csv")



###############################################################################################################################################
### Modeling the effect of drivers on the density of invasive species and the ratio between non-native and native fish species
###Additive models
#------------------------Density of exotic species------------------------------#
Model21<-lme(log(InvasiveFishDensity+1) ~
             SumNat_PFC + 
             XFC_NAT_ALG_AQM_scale + 
             I(UrbanActivityIndex^2) + 
             I(CroplandIntensity^2) + 
             MeanAnnualTemperature + 
             MeanPrecipitation + 
             SDDEPTH_CM +
             RiparianPresent + 
             CatchmentsArea,
             random =~1|YEAR/Ecoregions,
             control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
             correlation = corCompSymm(form = ~as.numeric(YEAR)),
             na.action = "na.fail",
             data = DataEuaFish1)

# Saving model output
summary(Model21)
Anova(Model21)
tab_model(Model21,transform = NULL)

# Check model assumptions
plot(Model21)
qqnorm(resid(Model21))
qqline(resid(Model21)) 
plot(Model21, SumAll_PFC~resid(.))
plot(Model21, UrbanActivityIndex~resid(.))
plot(Model21, CroplandIntensity~resid(.))
plot(Model21, MeanAnnualTemperature~resid(.))
plot(Model21, MeanPrecipitation~resid(.))
plot(Model21, SDDEPTH_CM~resid(.))
plot(Model21, RiparianPresent~resid(.))
plot(Model21, CatchmentsArea~resid(.))
# Testing VIF
vif(Model21) ## VIF < 3, indicating no collinearity


#save estimates and CIs:
Model21_95ci<-intervals(Model21, which="fixed", level = 0.95) # get 95% CI
Model21_75ci<-intervals(Model21,which="fixed",level=0.75) #get 75% CI
Model21_df<-data.frame(cbind(Model21_95ci$fixed, Model21_75ci$fixed))
colnames(Model21_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model21_df
#write.csv(Model1_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model1_df.csv")

###Run model to get scaled estimates for plot (Figure 1)
##(This way can compare magnitude of effects across explanatory variables with different ranges)

## run model scaled
Model21_scale<-lme(log(InvasiveFishDensity+1) ~
                   scale(SumNat_PFC, scale = TRUE, center = FALSE) + 
                   scale(XFC_NAT_ALG_AQM_scale, scale = TRUE, center = FALSE) + 
                   scale(I(UrbanActivityIndex^2), scale = TRUE, center = FALSE) + 
                   scale(I(CroplandIntensity^2), scale = TRUE, center = FALSE) + 
                   scale(MeanAnnualTemperature, scale = TRUE, center = FALSE) + 
                   scale(MeanPrecipitation, scale = TRUE, center = FALSE) + 
                   scale(SDDEPTH_CM, scale = TRUE, center = FALSE) +
                   scale(RiparianPresent, scale = TRUE, center = FALSE) + 
                   scale(CatchmentsArea, scale = TRUE, center = TRUE),
                   random =~1|YEAR/Ecoregions,
                   control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
                   correlation = corCompSymm(form = ~as.numeric(YEAR)),
                   na.action = "na.fail",
                   data = DataEuaFish1)


plot_summs(Model21_scale)
tab_model(Model21_scale)
summary(Model22_scale)
#save estimates and CIs:
Model21_scale_95ci<-intervals(Model21_scale, which="fixed", level = 0.95) # get 95% CI
Model21_scale_75ci<-intervals(Model21_scale,which="fixed",level=0.75) #get 75% CI
Model21_scale_df<-data.frame(cbind(Model21_scale_95ci$fixed, Model21_scale_75ci$fixed))
colnames(Model21_scale_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model21_scale_df
write.csv(Model21_scale_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model21_scale_df.csv")



#------------------------Density ratio exotic over native species------------------------------#
Model22<-lme(log(RatioInvasiveDensity+1) ~
             SumNat_PFC + 
             XFC_NAT_ALG_AQM_scale + 
             I(UrbanActivityIndex^2) + 
             I(CroplandIntensity^2) + 
             MeanAnnualTemperature + 
             MeanPrecipitation + 
             SDDEPTH_CM +
             RiparianPresent + 
             CatchmentsArea,
             random =~1|YEAR/Ecoregions,
             control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
             correlation = corCompSymm(form = ~as.numeric(YEAR)),
             na.action = "na.fail",
             data = DataEuaFish1)
# Saving model output
summary(Model22)
Anova(Model22)
tab_model(Model22,transform = NULL)

# Check model assumptions
plot(Model22) 
qqnorm(resid(Model22))
qqline(resid(Model22))
plot(Model22, SumNat_PFC~resid(.))
plot(Model22, UrbanActivityIndex~resid(.))
plot(Model22, CroplandIntensity~resid(.))
plot(Model22, MeanAnnualTemperature~resid(.))
plot(Model22, MeanPrecipitation~resid(.))
plot(Model22, SDDEPTH_CM~resid(.))
plot(Model22, RiparianPresent~resid(.))
plot(Model22, CatchmentsArea~resid(.))
# Testing VIF
vif(Model22) ## VIF < 3, indicating no collinearity


#save estimates and CIs:
Model22_95ci<-intervals(Model22, which="fixed", level = 0.95) # get 95% CI
Model22_75ci<-intervals(Model22,which="fixed",level=0.75) #get 75% CI
Model22_df<-data.frame(cbind(Model22_95ci$fixed, Model22_75ci$fixed))
colnames(Model22_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model22_df
#write.csv(Model1_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model1_df.csv")

###Run model to get scaled estimates for plot (Figure 1)
##(This way can compare magnitude of effects across explanatory variables with different ranges)

## run model scaled
Model22_scale<-lme(log(RatioInvasiveDensity+0.1) ~
                   scale(SumNat_PFC, scale = TRUE, center = FALSE) + 
                   scale(XFC_NAT_ALG_AQM_scale, scale = TRUE, center = FALSE) + 
                   scale(I(UrbanActivityIndex^2), scale = TRUE, center = FALSE) + 
                   scale(I(CroplandIntensity^2), scale = TRUE, center = FALSE) + 
                   scale(MeanAnnualTemperature, scale = TRUE, center = FALSE) + 
                   scale(MeanPrecipitation, scale = TRUE, center = FALSE) + 
                   scale(SDDEPTH_CM, scale = TRUE, center = FALSE) +
                   scale(RiparianPresent, scale = TRUE, center = FALSE) + 
                   scale(CatchmentsArea, scale = TRUE, center = TRUE),
                   random =~1|YEAR/Ecoregions,
                   control=list(msMaxIter=100,opt="optim",msVerbose=TRUE),
                   correlation = corCompSymm(form = ~as.numeric(YEAR)),
                   na.action = "na.fail",
                   data = DataEuaFish1)

plot_summs(Model22_scale)
tab_model(Model22_scale)
#save estimates and CIs:
Model22_scale_95ci<-intervals(Model22_scale, which="fixed", level = 0.95) # get 95% CI
Model22_scale_75ci<-intervals(Model22_scale,which="fixed",level=0.75) #get 75% CI
Model22_scale_df<-data.frame(cbind(Model22_scale_95ci$fixed, Model22_scale_75ci$fixed))
colnames(Model22_scale_df)<-c('ll_95', 'est', 'ul_95', 'll_75', 'est2', 'ul_75')
Model22_scale_df
write.csv(Model22_scale_df,"C:\\Users\\Dieison\\Desktop\\PaperDadosEUA\\Model22_scale_df.csv")




